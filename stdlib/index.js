#!/usr/bin/env node
             
const util = require('util');
const fs = require('fs');
const stream = require('stream');
const os = require('os');
const path = require('path');
const readline = require('readline');
const https = require('https');
const http = require('http');
const url = require('url');
const zlib = require('zlib');
const child_process = require('child_process');             function aa(a,b,c){return setTimeout(()=>{const d=Error(`${a?a:"Promise"} has timed out after ${b}ms`);d.stack=`Error: ${d.message}`;c(d)},b)}function ba(a,b){let c;const d=new Promise((e,f)=>{c=aa(a,b,f)});return{timeout:c,promise:d}}
async function w(a,b,c){if(!(a instanceof Promise))throw Error("Promise expected");if(!b)throw Error("Timeout must be a number");if(0>b)throw Error("Timeout cannot be negative");const {promise:d,timeout:e}=ba(c,b);try{return await Promise.race([a,d])}finally{clearTimeout(e)}};const x=util.debuglog;const ca=fs.createReadStream,ha=fs.createWriteStream,y=fs.lstat,ia=fs.mkdir,ja=fs.readdir,ka=fs.rmdir,la=fs.stat,ma=fs.unlink;var na=stream;const oa=stream.Transform,pa=stream.Writable;const z=(a,b=0,c=!1)=>{if(0===b&&!c)return a;a=a.split("\n",c?b+1:void 0);return c?a[a.length-1]:a.slice(b).join("\n")},qa=(a,b=!1)=>z(a,2+(b?1:0)),A=a=>{({callee:{caller:a}}=a);return a};const B=os.homedir;const C=/\s+at.*(?:\(|\s)(.*)\)?/,ra=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:IGNORED_MODULES)\/.*)?\w+)\.js:\d+:\d+)|native)/,sa=B(),D=(a,b)=>{const {pretty:c=!1,ignoredModules:d=["pirates"]}=b||{};b=d.join("|");const e=new RegExp(ra.source.replace("IGNORED_MODULES",b));return a.replace(/\\/g,"/").split("\n").filter(f=>{f=f.match(C);if(null===f||!f[1])return!0;f=f[1];return f.includes(".app/Contents/Resources/electron.asar")||f.includes(".app/Contents/Resources/default_app.asar")?!1:
!e.test(f)}).filter(f=>f.trim()).map(f=>c?f.replace(C,(g,h)=>g.replace(h,h.replace(sa,"~"))):f).join("\n")};function ta(a,b,c=!1){return function(d){var e=A(arguments),{stack:f}=Error();const g=z(f,2,!0),h=(f=d instanceof Error)?d.message:d;e=[`Error: ${h}`,...null!==e&&a===e||c?[b]:[g,b]].join("\n");e=D(e);return Object.assign(f?d:Error(),{message:h,stack:e})}};function E(a){var {stack:b}=Error();const c=A(arguments);b=qa(b,a);return ta(c,b,a)};const ua=(a,b)=>{b.once("error",c=>{a.emit("error",c)});return b};class va extends pa{constructor(a){const {binary:b=!1,rs:c=null,...d}=a||{},{f:e=E(!0),proxyError:f}=a||{},g=(h,l)=>e(l);super(d);this.a=[];this.i=new Promise((h,l)=>{this.on("finish",()=>{let k;b?k=Buffer.concat(this.a):k=this.a.join("");h(k);this.a=[]});this.once("error",k=>{if(-1==k.stack.indexOf("\n"))g`${k}`;else{const m=D(k.stack);k.stack=m;f&&g`${k}`}l(k)});c&&ua(this,c).pipe(this)})}_write(a,b,c){this.a.push(a);c()}get promise(){return this.i}}
const F=async(a,b={})=>{({promise:a}=new va({rs:a,...b,f:E(!0)}));return await a};async function G(a){a=ca(a);return await F(a)};async function H(a,b){if(!a)throw Error("No path is given.");const c=E(!0),d=ha(a);await new Promise((e,f)=>{d.on("error",g=>{g=c(g);f(g)}).on("close",e).end(b)})};const wa=x("bosom"),xa=async(a,b,c)=>{const {replacer:d=null,space:e=null}=c;b=JSON.stringify(b,d,e);await H(a,b)},I=async(a,b,c={})=>{if(b)return await xa(a,b,c);wa("Reading %s",a);a=await G(a);return JSON.parse(a)};async function J(a,b,c){const d=E(!0);if("function"!=typeof a)throw Error("Function must be passed.");if(!a.length)throw Error(`Function${a.name?` ${a.name}`:""} does not accept any arguments.`);return await new Promise((e,f)=>{const g=(l,k)=>l?(l=d(l),f(l)):e(c||k);let h=[g];Array.isArray(b)?h=[...b,g]:1<Array.from(arguments).length&&(h=[b,g]);a(...h)})};const K=path.dirname,L=path.join,ya=path.relative,M=path.resolve;async function za(a,b){b=b.map(async c=>{const d=L(a,c);return{lstat:await J(y,d),path:d,relativePath:c}});return await Promise.all(b)}const Aa=a=>a.lstat.isDirectory(),Ba=a=>!a.lstat.isDirectory();
async function N(a,b={}){if(!a)throw Error("Please specify a path to the directory");const {ignore:c=[]}=b;if(!(await J(y,a)).isDirectory())throw b=Error("Path is not a directory"),b.code="ENOTDIR",b;b=await J(ja,a);var d=await za(a,b);b=d.filter(Aa);d=d.filter(Ba).reduce((e,f)=>{var g=f.lstat.isDirectory()?"Directory":f.lstat.isFile()?"File":f.lstat.isSymbolicLink()?"SymbolicLink":void 0;return{...e,[f.relativePath]:{type:g}}},{});b=await b.reduce(async(e,{path:f,relativePath:g})=>{const h=ya(a,
f);if(c.includes(h))return e;e=await e;f=await N(f);return{...e,[g]:f}},{});return{content:{...d,...b},type:"Directory"}}const O=(a,b)=>{let c=[],d=[];Object.keys(a).forEach(f=>{const {type:g}=a[f];"File"==g?c.push(L(b,f)):"Directory"==g&&d.push(f)});const e=d.reduce((f,g)=>{const {content:h}=a[g];g=O(h,L(b,g));return[...f,...g]},[]);return[...c,...e]};async function P(a){try{await J(ia,a)}catch(b){if("ENOENT"==b.code){const c=K(a);await P(c);await P(a)}else if("EEXIST"!=b.code)throw b;}};const Q=async a=>{await J(ma,a)},R=async a=>{const {content:b}=await N(a);var c=Object.keys(b).filter(e=>{({type:e}=b[e]);if("File"==e||"SymbolicLink"==e)return!0}),d=Object.keys(b).filter(e=>{({type:e}=b[e]);if("Directory"==e)return!0});c=c.map(e=>L(a,e));await Promise.all(c.map(Q));d=d.map(e=>L(a,e));await Promise.all(d.map(R));await J(ka,a)};const Ca=(a,b,c,d=!1,e=!1)=>{const f=c?new RegExp(`^-(${c}|-${b})$`):new RegExp(`^--${b}$`);b=a.findIndex(g=>f.test(g));if(-1==b)return{argv:a};if(d)return{value:!0,index:b,length:1};d=a[b+1];if(!d||"string"==typeof d&&d.startsWith("--"))return{argv:a};e&&(d=parseInt(d,10));return{value:d,index:b,length:2}},Da=a=>{const b=[];for(let c=0;c<a.length;c++){const d=a[c];if(d.startsWith("-"))break;b.push(d)}return b};/*
 diff package https://github.com/kpdecker/jsdiff
 BSD License
 Copyright (c) 2009-2015, Kevin Decker <kpdecker@gmail.com>
*/
const Ea={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,grey:90},Fa={black:40,red:41,green:42,yellow:43,blue:44,magenta:45,cyan:46,white:47};const Ga=readline.createInterface;function Ha(a,b={}){const {timeout:c,password:d=!1,output:e=process.stdout,input:f=process.stdin,...g}=b,h=Ga({input:f,output:e,...g});if(d){const l=h.output;h._writeToOutput=k=>{if(["\r\n","\n","\r"].includes(k))return l.write(k);k=k.split(a);"2"==k.length?(l.write(a),l.write("*".repeat(k[1].length))):l.write("*")}}b=new Promise(l=>{h.question(a,l)});b=c?w(b,c,`reloquent: ${a}`):b;h.promise=Ia(b,h);return h}const Ia=async(a,b)=>{try{return await a}finally{b.close()}};async function S(a,b){if("object"!=typeof a)throw Error("Please give an object with questions");return await Object.keys(a).reduce(async(c,d)=>{c=await c;var e=a[d];switch(typeof e){case "object":e={...e};break;case "string":e={text:e};break;default:throw Error("A question must be a string or an object.");}e.text=`${e.text}${e.text.endsWith("?")?"":":"} `;var f;if(e.defaultValue)var g=e.defaultValue;e.getDefault&&(f=await e.getDefault());let h=g||"";g&&f&&g!=f?h=`\x1b[90m${g}\x1b[0m`:g&&g==f&&(h=
"");g=f||"";({promise:g}=Ha(`${e.text}${h?`[${h}] `:""}${g?`[${g}] `:""}`,{timeout:b,password:e.password,...e}));f=await g||f||e.defaultValue;"function"==typeof e.validation&&e.validation(f);"function"==typeof e.postProcess&&(f=await e.postProcess(f));return{...c,[d]:f}},{})};async function T(a,b){return await S(a,b)};function Ja(a){if("object"!=typeof a)return!1;const b=a.re instanceof RegExp;a=-1!=["string","function"].indexOf(typeof a.replacement);return b&&a}const U=(a,b)=>{if(!(b instanceof Error))throw b;[,,a]=a.stack.split("\n",3);a=b.stack.indexOf(a);if(-1==a)throw b;a=b.stack.substr(0,a-1);const c=a.lastIndexOf("\n");b.stack=a.substr(0,c);throw b;};async function Ka(a,b){return V(a,b)}
class W extends oa{constructor(a,b){super(b);this.g=(Array.isArray(a)?a:[a]).filter(Ja);this.a=!1;this.j=b}async replace(a,b){const c=new W(this.g,this.j);b&&Object.assign(c,b);a=await Ka(c,a);c.a&&this.brake();b&&Object.keys(b).forEach(d=>{b[d]=c[d]});return a}brake(){this.a=!0}async reduce(a){return await this.g.reduce(async(b,{re:c,replacement:d})=>{b=await b;if(this.a)return b;if("string"==typeof d)b=b.replace(c,d);else{const e=[];let f;const g=b.replace(c,(h,...l)=>{f=Error();try{if(this.a)return e.length?
e.push(Promise.resolve(h)):h;const k=d.call(this,h,...l);k instanceof Promise&&e.push(k);return k}catch(k){U(f,k)}});if(e.length)try{const h=await Promise.all(e);b=b.replace(c,()=>h.shift())}catch(h){U(f,h)}else b=g}return b},`${a}`)}async _transform(a,b,c){try{const d=await this.reduce(a);this.push(d);c()}catch(d){a=D(d.stack),d.stack=a,c(d)}}}async function V(a,b){b instanceof na?b.pipe(a):a.end(b);return await F(a)};const La=https.request;const Ma=http.request;const Na=url.parse;const Oa=zlib.createGunzip;const Pa=(a,b,c={})=>{const {justHeaders:d,binary:e,f=E(!0)}=c;let g,h,l,k,m=0,p=0;c=(new Promise((v,u)=>{g=a(b,async n=>{({headers:h}=n);l={statusMessage:n.statusMessage,statusCode:n.statusCode};if(d)n.destroy();else{var q="gzip"==n.headers["content-encoding"];n.on("data",t=>m+=t.byteLength);n=q?n.pipe(Oa()):n;k=await F(n,{binary:e});p=k.length}v()}).on("error",n=>{n=f(n);u(n)}).on("timeout",()=>{g.abort()})})).then(()=>({body:k,headers:h,...l,l:m,byteLength:p,h:null}));return{m:g,promise:c}};const Qa=(a={})=>Object.keys(a).reduce((b,c)=>{const d=a[c];c=`${encodeURIComponent(c)}=${encodeURIComponent(d)}`;return[...b,c]},[]).join("&").replace(/%20/g,"+"),Ra=async(a,b,{data:c,justHeaders:d,binary:e,f=E(!0)})=>{const {m:g,promise:h}=Pa(a,b,{justHeaders:d,binary:e,f});g.end(c);a=await h;if((a.headers["content-type"]||"").startsWith("application/json")&&a.body)try{a.h=JSON.parse(a.body)}catch(l){throw f=f(l),f.response=a.body,f;}return a};let X;try{const {version:a,name:b}=require("../package.json");X="@rqt/aqt"==b?`@rqt/aqt/${a}`:`@rqt/aqt via ${b}/${a}`}catch(a){X="@aqt/rqt"}const Sa=x("aqt");const Ta=child_process.fork,Ua=child_process.spawn;const Y=async a=>{const [b,c,d]=await Promise.all([new Promise((e,f)=>{a.on("error",f).on("exit",g=>{e(g)})}),a.stdout?F(a.stdout):void 0,a.stderr?F(a.stderr):void 0]);return{code:b,stdout:c,stderr:d}};const Z=async a=>await new Promise((b,c)=>{la(a,d=>{d&&"ENOENT"==d.code?b(!1):d?c(d):b(!0)})});async function Va(a,b,c){a=await T(a,c);await I(b,a,{space:2});return a};const Xa=async(a,b,c,d,e)=>a?await Wa(b,c,e,d):await Va(c,b,d),Wa=async(a,b,c,d)=>{const e=await I(a);return c?await Ya(b,a,e,d):e},Za=async(a,b,c,d,e,f,g)=>b?await Wa(d,e,g,f):(a=a?await I(c):{},await Ya(e,d,a,f)),Ya=async(a,b,c,d)=>{a=$a(a,c);return await Va(a,b,d)},$a=(a,b)=>Object.keys(a).reduce((c,d)=>{const e=b[d];return{...c,[d]:{...a[d],...e?{defaultValue:e}:{}}}},{});module.exports={exists:async a=>{try{return await J(y,a)}catch(b){return null}},ensurePath:async function(a){const b=K(a);try{return await P(b),a}catch(c){if(/EEXIST/.test(c.message)&&-1!=c.message.indexOf(b))return a;throw c;}},cleanStack:D,indicatrix:async function(a,b,c={}){const {interval:d=250,writable:e=process.stdout}=c;b="function"==typeof b?b():b;const f=e.write.bind(e);if((c=process.env.INDICATRIX_PLACEHOLDER)&&"0"!=c)return f(`${a}<INDICATRIX_PLACEHOLDER>`),await b;let g=1,h=`${a}${".".repeat(g)}`;
f(h);c=setInterval(()=>{g=(g+1)%4;h=`${a}${".".repeat(g)}`;f(`\r${" ".repeat(a.length+3)}\r`);f(h)},d);try{return await b}finally{clearInterval(c),f(`\r${" ".repeat(a.length+3)}\r`)}},promto:w,usually:function(a={usage:{}}){const {usage:b={},description:c,line:d,example:e}=a;a=Object.keys(b);const f=Object.values(b),[g]=a.reduce(([k=0,m=0],p)=>{const v=b[p].split("\n").reduce((u,n)=>n.length>u?n.length:u,0);v>m&&(m=v);p.length>k&&(k=p.length);return[k,m]},[]),h=(k,m)=>{m=" ".repeat(m-k.length);return`${k}${m}`};
a=a.reduce((k,m,p)=>{p=f[p].split("\n");m=h(m,g);const [v,...u]=p;m=`${m}\t${v}`;const n=h("",g);p=u.map(q=>`${n}\t${q}`);return[...k,m,...p]},[]).map(k=>`\t${k}`);const l=[c,`  ${d||""}`].filter(k=>k?k.trim():k).join("\n\n");a=`${l?`${l}\n`:""}
${a.join("\n")}
`;return e?`${a}
  Example:

    ${e}
`:a},bosom:I,readDirStructure:N,getFiles:O,read:G,write:H,rm:async a=>{(await J(y,a)).isDirectory()?await R(a):await Q(a)},argufy:function(a={},b=process.argv){let [,,...c]=b;const d=Da(c);c=c.slice(d.length);a=Object.entries(a).reduce((g,[h,l])=>{g[h]="string"==typeof l?{short:l}:l;return g},{});const e=[];a=Object.entries(a).reduce((g,[h,l])=>{let k;try{const m=l.short,p=l.boolean,v=l.number,u=l.command,n=l.multiple;if(u&&n&&d.length)k=d;else if(u&&d.length)k=d[0];else{const q=Ca(c,h,m,p,v);({value:k}=
q);const t=q.index,r=q.length;void 0!==t&&r&&e.push({index:t,length:r})}}catch(m){return g}return void 0===k?g:{...g,[h]:k}},{});let f=c;e.forEach(({index:g,length:h})=>{Array.from({length:h}).forEach((l,k)=>{f[g+k]=null})});f=f.filter(g=>null!==g);Object.assign(a,{o:f});return a},reduceUsage:a=>Object.keys(a).reduce((b,c)=>{const d=a[c];if("string"==typeof d)return b[`-${d}`]="",b;c=d.command?c:`--${c}`;d.short&&(c=`${c}, -${d.short}`);let e=d.description;d.default&&(e=`${e}\nDefault: ${d.default}.`);
b[c]=e;return b},{}),c:function(a,b){return(b=Ea[b])?`\x1b[${b}m${a}\x1b[0m`:a},b:function(a,b){return(b=Fa[b])?`\x1b[${b}m${a}\x1b[0m`:a},mismatch:function(a,b,c,d=!1){const e=[];b.replace(a,(f,...g)=>{f=g[g.length-2];f=d?{position:f}:{};g=g.slice(0,g.length-2).reduce((h,l,k)=>{k=c[k];if(!k||void 0===l)return h;h[k]=l;return h},f);e.push(g)});return e},askQuestions:T,askSingle:async function(a,b){({question:a}=await S({question:a},b));return a},confirm:async function(a,b={}){const {defaultYes:c=
!0,timeout:d}=b;a="string"==typeof a?{text:a}:a;b=a.text;const e=b.endsWith("?");({question:a}=await S({question:{defaultValue:c?"y":"n",...a,text:`${e?b.replace(/\?$/,""):b} (y/n)${e?"?":""}`}},d));return"y"==a},Replaceable:W,replace:V,aqt:async(a,b={})=>{const {data:c,type:d="json",headers:e={"User-Agent":`Mozilla/5.0 (Node.JS) ${X}`},compress:f=!0,binary:g=!1,justHeaders:h=!1,method:l,timeout:k}=b;b=E(!0);const {hostname:m,protocol:p,port:v,path:u}=Na(a),n="https:"===p?La:Ma,q={hostname:m,port:v,
path:u,headers:{...e},timeout:k,method:l};if(c){var t=d;var r=c;switch(t){case "json":r=JSON.stringify(r);t="application/json";break;case "form":r=Qa(r),t="application/x-www-form-urlencoded"}r={data:r,contentType:t};({data:t}=r);r=r.contentType;q.method=l||"POST";"Content-Type"in q.headers||(q.headers["Content-Type"]=r);"Content-Length"in q.headers||(q.headers["Content-Length"]=Buffer.byteLength(t))}!f||"Accept-Encoding"in q.headers||(q.headers["Accept-Encoding"]="gzip, deflate");const {body:ab,headers:bb,
byteLength:da,statusCode:cb,statusMessage:db,l:ea,h:fa}=await Ra(n,q,{data:t,justHeaders:h,binary:g,f:b});Sa("%s %s B%s",a,da,`${da!=ea?` (raw ${ea} B)`:""}`);return{body:fa?fa:ab,headers:bb,statusCode:cb,statusMessage:db}},spawn:function(a,b,c){if(!a)throw Error("Please specify a command to spawn.");a=Ua(a,b,c);b=Y(a);a.promise=b;a.spawnCommand=a.spawnargs.join(" ");return a},fork:function(a,b,c){if(!a)throw Error("Please specify a module to fork");a=Ta(a,b,c);b=Y(a);a.promise=b;a.spawnCommand=a.spawnargs.join(" ");
return a},africa:async function(a,b={},c={}){if("string"!=typeof a)throw Error("Package name is required.");const {homedir:d=B(),rcNameFunction:e=k=>`.${k}rc`,force:f=!1,local:g=!1,questionsTimeout:h}=c;var l=e(a);a=M(d,l);c=await Z(a);if(g){l=M(l);const k=await Z(l);return await Za(c,k,a,l,b,h,f)}return await Xa(c,a,b,h,f)}};

//# sourceMappingURL=index.js.map