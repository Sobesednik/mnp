{"version":3,"sources":["../../src/bin/mnp.js"],"names":["ANSWER_TIMEOUT","argv","process","argvPackage","argvPackageName","structure","org","token","name","email","website","legalName","questions","packageName","text","validation","a","Error","packagePath","console","log","description","postProcess","s","trim","defaultValue","ssh_url","sshUrl","git_url","gitUrl","html_url","htmlUrl","readmeUrl","issuesUrl","Promise","all","authorName","authorEmail","year","Date","getFullYear","controlled","message","stack","error","exit"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport { resolve } from 'path'\nimport { assertDoesNotExist } from 'wrote'\nimport africa from 'africa'\nimport { askQuestions } from 'reloquent'\nimport cloneSource from '../lib/clone-source'\nimport git from '../lib/git'\nimport { assertNotInGitPath } from '../lib/git-lib'\nimport { createRepository } from '../lib/github'\nimport { findStructure } from '../lib'\nimport questions from './questions'\n\nconst ANSWER_TIMEOUT = null\n\nconst { argv } = process\nconst [, , argvPackage] = argv\nconst argvPackageName = argvPackage == '-s' ? null : argvPackage\n\n;(async () => {\n  try {\n    const structure = findStructure(argv)\n    const {\n      org, token, name, email, website, legalName,\n    } = await africa('mnp', questions)\n\n    const packageName = argvPackageName ? argvPackageName : await askQuestions({\n      packageName: {\n        text: 'Package name: ',\n        validation(a) {\n          if (!a) throw new Error('You must specify package name')\n        },\n      },\n    }, ANSWER_TIMEOUT, 'packageName')\n\n    const packagePath = resolve(packageName)\n    await assertDoesNotExist(packagePath)\n\n    await assertNotInGitPath()\n\n    console.log(`# ${packageName}`)\n\n    const description = await askQuestions({\n      description: {\n        text: 'Description: ',\n        postProcess: s => s.trim(),\n        defaultValue: '',\n      },\n    }, ANSWER_TIMEOUT, 'description')\n\n    const {\n      ssh_url: sshUrl,\n      git_url: gitUrl,\n      html_url: htmlUrl,\n    } = await createRepository(token, packageName, org, description)\n\n    if (!sshUrl) throw new Error('GitHub repository was not created via API.')\n\n    const readmeUrl = `${htmlUrl}#readme`\n    const issuesUrl = `${htmlUrl}/issues`\n\n    await git(['clone', sshUrl, packagePath])\n\n    console.log('Setting user %s<%s>...', name, email)\n    await Promise.all([\n      git(['config', 'user.name', name], packagePath),\n      git(['config', 'user.email', email], packagePath),\n    ])\n\n    await cloneSource(structure, packagePath, {\n      org,\n      packageName,\n      website,\n      authorName: name,\n      authorEmail: email,\n      year: `${new Date().getFullYear()}`,\n      issuesUrl,\n      readmeUrl,\n      gitUrl,\n      description,\n      legalName,\n    })\n    console.log('Cloned the structure to %s', packagePath)\n    console.log('Created new repository: %s', readmeUrl)\n\n    await git('add .', packagePath)\n    await git(['commit', '-m', 'initialise package'], packagePath)\n    await git('push origin master', packagePath)\n  } catch ({ controlled, message, stack }) {\n    if (controlled) {\n      console.error(message)\n    } else {\n      console.error(stack)\n    }\n    process.exit(1)\n  }\n})()\n"],"file":"mnp.js"}