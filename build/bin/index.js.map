{"version":3,"sources":["../../src/bin/index.js"],"names":["struct","help","name","check","short","boolean","command","process","argv","ANSWER_TIMEOUT","u","console","log","exit","available","structure","org","token","userName","email","website","legalName","questions","packageName","text","validation","a","Error","path","description","postProcess","s","trim","defaultValue","ssh_url","sshUrl","git_url","gitUrl","html_url","htmlUrl","readmeUrl","issuesUrl","Promise","all","authorName","authorEmail","year","Date","getFullYear","controlled","message","stack","error"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport { resolve } from 'path'\nimport { assertDoesNotExist } from 'wrote'\nimport africa from 'africa'\nimport { askQuestions } from 'reloquent'\nimport argufy from 'argufy'\nimport { c } from 'erte'\nimport getUsage from './usage'\nimport questions from './questions'\nimport cloneSource from '../lib/clone-source'\nimport git from '../lib/git'\nimport { assertNotInGitPath } from '../lib/git-lib'\nimport { createRepository } from '../lib/github'\nimport { getStructure } from '../lib'\nimport info from '../lib/info'\n\nconst { struct, help, name, check } = argufy({\n  struct: 's',\n  help: { short: 'h', boolean: true },\n  name: { command: true },\n  check: 'c',\n}, process.argv)\n\nconst ANSWER_TIMEOUT = null\n\nif (help) {\n  const u = getUsage()\n  console.log(u)\n  process.exit()\n}\n\n(async () => {\n  try {\n    if (check) {\n      console.log('Checking package %s...', check)\n      const available = await info(check)\n      console.log('Package named %s is %s.', available ? c(check, 'green') : c(check, 'red'), available ? 'available' : 'taken')\n      return\n    }\n    const structure = getStructure(struct)\n    const {\n      org, token, name: userName, email, website, legalName,\n    } = await africa('mnp', questions)\n\n    const packageName = name ? name : await askQuestions({\n      packageName: {\n        text: 'Package name: ',\n        validation(a) {\n          if (!a) throw new Error('You must specify package name')\n        },\n      },\n    }, ANSWER_TIMEOUT, 'packageName')\n\n    const path = resolve(packageName)\n    await assertDoesNotExist(path)\n\n    await assertNotInGitPath()\n\n    console.log(`# ${packageName}`)\n\n    const description = await askQuestions({\n      description: {\n        text: 'Description: ',\n        postProcess: s => s.trim(),\n        defaultValue: '',\n      },\n    }, ANSWER_TIMEOUT, 'description')\n\n    const {\n      ssh_url: sshUrl,\n      git_url: gitUrl,\n      html_url: htmlUrl,\n    } = await createRepository(token, packageName, org, description)\n\n    if (!sshUrl) throw new Error('GitHub repository was not created via API.')\n\n    const readmeUrl = `${htmlUrl}#readme`\n    const issuesUrl = `${htmlUrl}/issues`\n\n    await git(['clone', sshUrl, path])\n\n    console.log('Setting user %s<%s>...', userName, email)\n    await Promise.all([\n      git(['config', 'user.name', userName], path),\n      git(['config', 'user.email', email], path),\n    ])\n\n    await cloneSource(structure, path, {\n      org,\n      packageName,\n      website,\n      authorName: userName,\n      authorEmail: email,\n      year: `${new Date().getFullYear()}`,\n      issuesUrl,\n      readmeUrl,\n      gitUrl,\n      description,\n      legalName,\n    })\n    console.log('Cloned the structure to %s', path)\n    console.log('Created new repository: %s', readmeUrl)\n\n    await git('add .', path)\n    await git(['commit', '-m', 'initialise package'], path)\n    await git('push origin master', path)\n  } catch ({ controlled, message, stack }) {\n    if (controlled) {\n      console.error(message)\n    } else {\n      console.error(stack)\n    }\n    process.exit(1)\n  }\n})()\n"],"file":"index.js"}