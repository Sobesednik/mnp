{"version":3,"sources":["../../src/bin/index.js"],"names":["struct","help","name","_name","check","delete","_delete","init","desc","_description","version","_version","short","boolean","command","console","log","process","exit","ANSWER_TIMEOUT","makeGitLinks","org","ssh_url","git_url","html_url","u","getPackageNameWithScope","packageName","scope","text","validation","a","Error","available","structure","scripts","structurePath","onCreate","token","userName","email","website","legalName","trademark","y","path","description","postProcess","s","trim","defaultValue","sshUrl","gitUrl","htmlUrl","readmeUrl","issuesUrl","authorName","authorEmail","controlled","message","stack","error"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\nimport { resolve } from 'path'\nimport { assertDoesNotExist } from 'wrote'\nimport { askSingle } from 'reloquent'\nimport argufy from 'argufy'\nimport { c, b } from 'erte'\nimport getUsage from './usage'\nimport cloneSource from '../lib/clone-source'\nimport git from '../lib/git'\nimport { assertNotInGitPath } from '../lib/git-lib'\nimport { createRepository, starRepository, deleteRepository } from '../lib/github'\nimport { getStructure, create } from '../lib'\nimport info from '../lib/info'\nimport signIn from '../lib/sign-in'\nimport { version } from '../../package.json'\n\nconst {\n  struct, help, name: _name, check, delete: _delete, init, desc: _description,\n  version: _version,\n} = argufy({\n  struct: 's',\n  help: { short: 'h', boolean: true },\n  desc: { short: 'D' },\n  name: { command: true },\n  version: { short: 'v', boolean: true },\n  check: { short: 'c', boolean: true },\n  delete: { short: 'd', boolean: true },\n  init: { short: 'I', boolean: true },\n})\n\nif (_version) {\n  console.log(version)\n  process.exit()\n}\n\nconst ANSWER_TIMEOUT = null\n\nconst makeGitLinks = (org, name) => ({\n  ssh_url: `git://github.com/${org}/${name}.git`,\n  git_url: 123,\n  html_url: `https://github.com/${org}/${name}#readme`,\n})\n\nif (help) {\n  const u = getUsage()\n  console.log(u)\n  process.exit()\n}\n\nconst getPackageNameWithScope = (packageName, scope) => {\n  return `${scope ? `@${scope}/` : ''}${packageName}`\n}\n\n(async () => {\n  try {\n    if (init) {\n      await signIn(true)\n      return\n    }\n\n    const name = _name || await askSingle({\n      text: 'Package name',\n      validation(a) {\n        if (!a) throw new Error('You must specify the package name.')\n      },\n    }, ANSWER_TIMEOUT)\n\n    if (check) {\n      console.log('Checking package %s...', name)\n      const available = await info(name)\n      console.log('Package named %s is %s.', available ? c(name, 'green') : c(name, 'red'), available ? 'available' : 'taken')\n      return\n    }\n\n    const { structure, scripts, structurePath } = getStructure(struct)\n    const { onCreate } = scripts\n\n    const {\n      org, token, name: userName, email, website, legalName, trademark, scope,\n    } = await signIn()\n\n    const packageName = getPackageNameWithScope(name, scope)\n\n    if (_delete) {\n      const y = await askSingle(`Are you sure you want to delete ${packageName}?`)\n      if (y != 'y') return\n      await deleteRepository(token, name, org)\n      console.log('Deleted %s/%s.', org, name)\n      return\n    }\n\n    const path = resolve(name)\n    await assertDoesNotExist(path)\n\n    await assertNotInGitPath()\n\n    console.log(`# ${packageName}`)\n\n    const description = _description || await askSingle({\n      text: 'Description',\n      postProcess: s => s.trim(),\n      defaultValue: '',\n    }, ANSWER_TIMEOUT)\n\n    const {\n      ssh_url: sshUrl,\n      git_url: gitUrl,\n      html_url: htmlUrl,\n    } = await createRepository(token, name, org, description)\n\n    if (!sshUrl) throw new Error('GitHub repository was not created via API.')\n\n    await starRepository(token, name, org)\n    console.log('%s\\n%s', c('Created and starred a new repository', 'grey'), b(htmlUrl, 'green'))\n\n    const readmeUrl = `${htmlUrl}#readme`\n    const issuesUrl = `${htmlUrl}/issues`\n\n    await git(['clone', sshUrl, path])\n\n    console.log('Setting user %s<%s>...', userName, email)\n    await git(['config', 'user.name', userName], path)\n    await git(['config', 'user.email', email], path)\n\n    await cloneSource(structure, path, {\n      org,\n      name,\n      scope,\n      packageName,\n      website,\n      authorName: userName,\n      authorEmail: email,\n      issuesUrl,\n      readmeUrl,\n      gitUrl,\n      description,\n      legalName,\n      trademark,\n    })\n\n    await git('add .', path, true)\n    await git(['commit', '-m', 'initialise package'], path, true)\n    console.log('Initialised package structure, pushing.')\n    await git('push origin master', path, true)\n\n    if (onCreate) {\n      await create(path, structurePath, onCreate)\n    }\n\n    console.log('Created a new package: %s.', c(packageName, 'green'))\n  } catch ({ controlled, message, stack }) {\n    if (controlled) {\n      console.error(message)\n    } else {\n      console.error(stack)\n    }\n    process.exit(1)\n  }\n})()\n"],"file":"index.js"}